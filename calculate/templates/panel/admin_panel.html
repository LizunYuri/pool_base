{% extends "sample/panel_sample.html" %}


{% block header %}
    <div class="panel-header-account">
        <p class="panel-header-account-link"><i class="fas fa-user-shield"></i>{{ user.first_name }}<i id="user-chevron" class="fas fa-chevron-down"></i><br><span>{{ user.groups.first }}</span></p>
        <div class="panel-header-logout">
            <a class="panel-header-logout-btn" href="{% url 'logout' %}">Выйти</a>
        </div>
    </div>
{% endblock %}

{% block aside %}
    <ul class="aside-link">
        <li data-url="{% url 'clients_list' %}" class="load-content panel-link" id='addClientsList'><i class="fas fa-users"></i><span>Клиенты</span></li>
        <li class=" load-content panel-link" >catalogs</li>
    </ul>
{% endblock %}
{% block nav %}
    <div class="nav-title"></div>
{% endblock %}

{% block content %}
    <section id="client-list" class="content-list">
    </section>
{% endblock %}


{% block script %}
    <script>
        $(document).ready(function() {
            let isContentLoaded = false;  // Флаг для проверки, загружен ли контент
            
            $('.load-content').click(function() {
                const url = $(this).data('url');

                // Проверка: если контент уже загружен, не отправлять повторный запрос
                if (isContentLoaded) {
                    return;
                }

                $.ajax({
                    url: url,
                    method: 'GET',
                    success: function(response) {
                        console.log('Загрузка данных по URL:', url);
                        $('#client-list').html(response);  // Отображение загруженного контента
                        isContentLoaded = true;  // Обновляем флаг, чтобы предотвратить повторные запросы
                    },
                    error: function(xhr, status, error) {
                        console.error('Ошибка при загрузке данных:', error);
                        $('#client-list').html('<p>Не удалось загрузить данные.</p>');
                    }
                });
            });
        });
    </script>
   <!-- <script>
        const clientList = document.getElementById('client-list')
        const navTitle = document.querySelector('.nav-title')
        $(document).ready(() =>{
            $(addClientsList).click(() => {
                $.ajax({
                    url: '/clients/get-clients',
                    method : 'GET',
                    success : (response) => {
                        let clientsData = response.clients
                        navTitle.innerHTML = `
                            <div class="nav-link-body">
                                <p>Клиенты</p>
                            </div>
                            `
                        let tableHtml = `
                            <table class="content-list" style="flex-direction: column;">
                                <thead class="content-list-table">
                                    <tr class="content-list-table">
                                        <th class="content-container-card table-title">Имя</th>
                                        <th class="content-container-card table-title">Город</th>
                                        <th class="content-container-card table-title">Телефон</th>
                                        <th class="content-container-card table-title">Электронная почта</th>
                                        <th class="content-container-card table-title">Комментарий</th>
                                    </tr>
                                </thead>
                                <tbody>
                            `;
                        $.each(response.clients, (index, client) => {
                            tableHtml += `
                                    <tr class="content-list-table" onclick="window.location.href='#'">
                                        <th class="content-container-card">${client.name}</th>
                                        <th class="content-container-card">${client.city}</th>
                                        <th class="content-container-card">${client.phone}</th>
                                        <th class="content-container-card">${client.email}</th>
                                        <th class="content-container-card">${client.note}</th>
                                    </tr>
                            `
                        })
                        console.log(clientsData)
                        tableHtml += `
                                </tbody>
                            </table>
                            `;
                        clientList.innerHTML = tableHtml
                    },
                    error: (xhf, status, error) => {
                        console.error('error load data: ', error)
                    }
                })
            })
        })
    </script> -->
{% endblock %}